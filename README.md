# Project 4 dokumentasjon
## Oppgave
I prosjekt 4 har vi valgt å gjøre oppgave c og e:
Perfeksjonere klient og backend i prosjekt 3 (passer for de som har åpenbare mangler i prosjekt 3, eller kombiner med punktet over)
Bearbeide klienten med fokus på bærekraft (se forelesning), metrikker og prøve ut verktøy for å måle effekt av designvalg mtp ressursbruk og datatrafikk
Vi valgte å gjøre to oppgaver for å holde på gruppen på 4 personer. Med to oppgaver hadde vi nok arbeid til å fylle ut arbeidstiden på 4 x 8 timer i uka per gruppemedlem. Oppgavevalget innebærer at vi har fikset backend og klient basert på kjente feil og det vi ikke fikk tid til i prosjekt 3. I tillegg har vi forbedret applikasjonen med tanke på bærekraftig webutvikling. 
 
 
## Generelt om løsningen
Løsningen vår er en nettside hvor man kan huke av land man har vært i, og filtrere slik at man får en oversikt over alle landene man har besøkt. På nettsiden må en registrere en bruker før en kan logge inn, og dette medfører at dataen blir tatt vare på i databasen. Etter en har logget inn kan en søke etter land og sortere enten stigende eller synkende. Databasen vår er lagd med MongoDB og all data kommer fra en csv-fil generert med APIet fra restcountries.com. Vi valgte dette APIet fordi det hadde en tilstrekkelig mengde data med både land og informasjon om hvert land. Dette gjør at vi får et stort datasett som vi kan hente ut mye informasjon fra, som var et av kravene i oppgaveteksten. I tillegg har vi brukt Express.js som backend med GraphQL.
 
## State management
For state management har vi benyttet oss av Recoil som er et state management bibliotek i React. Med Recoil kan man lagre tilstander ved bruk av enheter kalt Atoms, som deles slik at man kan benytte og oppdatere en tilstand flere steder. I tillegg bruker vi enheter som kalles Selectors. Hvor Atoms kun handler om deling av data som en global variabel, er Selectors som en global funksjon, som blir utløst  når en Atom den bruker oppdateres, og kjører en funksjon som oppdaterer Selectoren. Både Atoms og Selector er brukt for å ta vare på data om land, brukere og valgt fargetema på hele nettsiden, slik at vi slipper å sende inn all data som props i hver enkelt komponent. Alle tilstandene som blir lagret med Recoil ligger i filene CountryData.tsx og UserData.tsx. Siden Recoil egentlig er et bibliotek som baserer seg på at alt skjer synkront, fungerer ikke dette like godt på asynkrone sider. Siden krevde derfor at vi brukte React Suspense som default laste-side mens siden laster når vi gjør kall til backend. Dette gjør at deler av siden “blinker” når kall skjer. Dette er forstyrrende og ubehagelig for brukere, og er derfor noe vi ønsker å forandre på til et eventuelt neste prosjekt, hvor en kan finne et annet state management bibliotek å bruke, som er mer kompatibel med en asynkron nettside. 
 
## Komponenter og pages
Komponentene er delt opp i HTML-tags på sidene våre, som vi så har importert for å lage større komponenter som er satt inn på pages. Grunnen til at vi bruker pages er fordi det benyttes i HashRoutingen på siden. Vi trenger dermed bare å route mellom pages, mens komponentene på hver side allerede ligger inne. Ettersom at vi ikke har en header som går over alle sidene, fungerte dette fint for oss. Routingen er gjort med Hashrouting fordi dette var kompatibelt med vm, og det er en grei løsning når vi ikke har komplekse routinger.
 
## Søk og filtrering
Vi har implementert filtrering, hvor brukeren kan filtrere på land hen har besøkt. Input fra brukeren tas inn ved å klikke på jordkloden til venstre på hvert enkelt land. Da vil jordkloden få farge, som symboliserer at brukeren har vært i dette landet. Da vil man altså kunne finne dette landet ved å filtrere på land man har besøkt, “My countries”. I tillegg har vi implementert et søkefelt i headeren hvor man kan søke både på alle land i databasen, og landene brukeren har besøkt. Her vil land som inneholder søkeordet dukke opp.
 
## Responsivitet
Nettsiden er laget med mobile-first strategi. All skalering på siden skjer når skjermen bikker 768 pixler i bredden. Dette har gjort at siden fungerer bra og ser fin ut både på mobil og på større skjermer. Vi opplevde det som enklere å style mobile-first enn å skalere ned komponentene, fordi plasseringen av komponentene krevde mindre endring, og siden vi benyttet Tailwind som i utgangspunktet er et mobile-first rammeverk. Vi har også fjernet jordkloden på bakgrunnsbilde på mindre skjermer, slik at det er færre elementer som kan distrahere på små skjermer. Vi har brukt Tailwind for å style appen og all styling er in-line. Dette har gjort det enkelt å style enkeltkomponenter, og vi unngår rotete css-filer til småting. Responsiviteten er testet på både mobil og på laptop-skjerm.
 
## Utforming og tilgjengelighet
For designet har vi valgt å holde oss til et gjennomgående tema med tydelige farger, eksempelvis svart tekst på hvit bakgrunn i light mode og hvit tekst mot den mørke bakgrunnen i dark mode. Vi har også forsøkt å lage gjenkjennbare komponenter med et design slik brukeren forventer for å forbedre brukeropplevelsen. Feilmeldinger er skrevet med sterke kontrastfarger for å enkelt gjøre brukeren oppmerksom på at noe er galt. Når en logger inn på siden vil en informasjonsboks vises. Her får en info om at en må trykke på jordklodene for å legge de til i “My countries”. Dette gjorde vi fordi løsningen ikke er så intuitiv i utgangspunktet, men etter informasjonsboksen vil det være forståelig. 
 
 
## Bærekraft
Når det kommer til bærekraft finnes det flere metrikker i forskjellige industrier hvor man kan måle påvirkningen på klima. Innen webutvikling derimot, er det ingen standardiserte metrikker for å måle bærekraftighet, noe som gjør det vanskelig å anslå hvor bærekraftig et nettsted egentlig er. Men selv om dette ikke direkte kan måles, finnes det flere tiltak man kan gjøre som er vist å gjøre produktet mer bærekraftig.
 
Valg av farger på en nettside påvirker hvor mye energi som kreves for å bruke siden, og er derfor en stor faktor når det kommer til bærekraftig webutvikling. Mørke farger krever mindre energi for å lyse opp, og vi har derfor valgt å implementere dark mode. Dette gir brukeren muligheten til å redusere energi som går til å lyse opp skjermen, noe som i tillegg er mer behagelig for øynene. Vi har også forsøkt å gjenbruke farger for å redusere antall farger i nettsidens fargepalett. Dette er også med på å gjøre nettsiden mer bærekraftig ettersom at færre farger i bildet er mindre energikrevende. Røde og grønne farger er omtrent 25% mindre energikrevende enn blå-farger, men etter å ha tatt en vurdering på dette har vi valgt å beholde vårt design i blåtoner. Årsaken til dette er at det hadde kostet mye tid å endre hele designet — tid vi heller investerte i å utføre flere andre bærekraftige tiltak. For å redusere både datatrafikk og energibruk på klienten, har vi tatt et valg om å unngå all form for video og animasjon på nettsiden. Alt av bilder er lagret i svg, hvor vi også har redusert størrelsen på hver enkelt svg ved å komprimere bildene slik at alt av unødvendig data blir fjernet. På denne måten har vi klart å redusere 20-25% av filstørrelsen til hvert enkelt bilde. Noe som igjen er med på å gi et mer bærekraftig produkt. Et annet tiltak man kan gjøre er å minimere bruken av egendefinerte fonter, samt redusere spesiell vekting av tekst, slik som bold og kursiv tekst. På nettsiden vår har vi utviklet et design hvor vi ikke importerer noen egendefinerte fonter, og i hovedsak fremhever kritiske elementer ved å benytte farger med kontraster, istedenfor tekstvekting. Ett unntak er i filtreringsmenyen i light mode, hvor vi benytter bold for å øke synligheten, mellom de forskjellige fargene. Dette er fordi sterkere farger ikke var et alternativ her, ettersom det gjør det vanskeligere å se hvilket filtreringsalternativ som er valgt. Vi har også et design hvor man unngår overdreven navigering mellom flere sider. Når man logger inn vil man bli sendt til en side hvor alt av nødvendig funksjonalitet er samlet, og man slipper å navigere mye fram og tilbake. Dette er med på å redusere hver enkelts tidsbruk inne på siden, og har derfor en positiv påvirkning på både brukervennlighet og nettsidens bærekraftighet. 
 
En metrikk som benyttes for å måle energieffektivitet er kilowattimer per GB. For nettsider kan man måle mengden data som overføres over internett når siden er i bruk. Dette kan måles ved å se på overføringsstørrelsen første gang en besøker siden, noe som enkelt kan måles med developer tools i de fleste nettlesere. Når vi laster nettsiden kan en måle hva som bruker mest energi. På målingen kan vi se at en mappe som heter bundle.js er den som er størst hos oss. Dette er en mappe som React lager ved å benytte verktøyet Webpack, for å mer effektivt laste opp all grafikken til nettsiden. Dette er vår mest krevende opplastning, og for å gjøre denne så liten som mulig har vi gjort grafikken så liten som mulig, som vi har skrevet om lenger opp. Kall til backend utgjør mye av trafikken til en nettside, og når man har store datasett er det viktig å gjøre dette på en best mulig måte. Siden datasettet er så stort er det lite bærekraftig å laste inn hele databasen når brukeren besøker nettsiden. Derfor er kallene lagt opp slik at en heller sender flere, og mindre kall til backenden når bruker foretar seg noe på siden. Et eksempel på dette er pagination, hvor for hver gang brukeren ønsker å se flere land, vil siden kun hente de ni neste landene fra backend.
 
 
 
## Tester
Nettsiden vår er testet med både ende-til-ende testing samt et par enkle enhetstester for å teste at det fungerer slik det skal. Ende-til-ende testen er laget med JavaScript rammeverket Cypress, og tester paginering ved å bla fram og tilbake og sjekke hvilke land som er i listen, samt filtrering og at riktig info kommer når man klikker på et land. Enhetstestene er lagd med React-testing-library og JavaScript test rammeverket Jest, hvor det testes at komponentene rendres og at det som skal vises faktisk vises på nettsiden. For å kjøre cypress tester npx cypress run. For å kjøre Jest tester npm test.
 
## Kilder
https://sustainablewww.org/
https://sustainablewebdesign.org/
https://alistapart.com/article/sustainable-web-design-excerpt/
 
